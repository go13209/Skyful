{% extends "base.html" %}
{% load static %}

{% block style %}
  <link rel="stylesheet" href="{% static "css/mypage.css" %}"> 
{% endblock style %}

{% block content %}
  <div class="main-box">
    <div class="profile-box">
      {% if person.profile_img %}
      <img src="{{ person.profile_img.url }}" alt="í”„ë¡œí•„ ì´ë¯¸ì§€" />
      {% else %} <img src="{% static "img/user.png" %}" alt=""> {% endif %}
      <p>{{ person.nickname }} ({{ person.username }})</p>
      <p class="follow-list">
        <button type="button" data-bs-toggle="modal" data-bs-target="#followings">
          íŒ”ë¡œì‰ {{ followings.count }}
        </button>
        |
        <button type="button" data-bs-toggle="modal" data-bs-target="#followers">
          íŒ”ë¡œì›Œ {{ followers.count }}
        </button>
      </p>

      <div class="modal fade" id="followings" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">íŒ”ë¡œì‰({{ followings.count }})</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              {% if followings.count > 0 %}
                {% for following in followings %}
                <div class="friend-box">
                  <div class="friend-info-box">
                    {% if following.profile_img %}
                      <img src="{{ following.profile_img.url }}" alt="í”„ë¡œí•„ ì´ë¯¸ì§€">
                    {% else %}
                      <img src="{% static "img/user.png" %}" alt="ê¸°ë³¸ í”„ë¡œí•„ ì´ë¯¸ì§€">
                    {% endif %}
                    <span>
                      {{ following.nickname }}({{ following.username }})
                    </span>
                  </div>
                  <form action="{% url "accounts:follow" following.pk %}" method="POST">
                    {% csrf_token %}
                    {% if following in followings %}
                      <button>íŒ”ë¡œìš° ì·¨ì†Œ</button>
                    {% else %}
                      <button>íŒ”ë¡œìš°</button>
                    {% endif %}
                  </form>
                </div>
                {% if not forloop.last %}
                  <br>
                {% endif %}
                {% endfor %}
              {% else %}
                <div>íŒ”ë¡œìš° ì¤‘ì¸ ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤. ì¹œêµ¬ ì°¾ê¸° ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ë³´ì„¸ìš”!</div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="followers" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">íŒ”ë¡œì›Œ({{ followers.count }})</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              {% if followers.count > 0 %}
                {% for follower in followers %}
                <div class="friend-box">
                  <div class="friend-info-box">
                    {% if follower.profile_img %}
                      <img src="{{ follower.profile_img.url }}" alt="í”„ë¡œí•„ ì´ë¯¸ì§€">
                    {% else %}
                      <img src="{% static "img/user.png" %}" alt="ê¸°ë³¸ í”„ë¡œí•„ ì´ë¯¸ì§€">
                    {% endif %}
                    <span>
                      {{ follower.nickname }}({{ follower.username }})
                    </span>
                  </div>
                  <form action="{% url "accounts:follow" follower.pk %}" method="POST">
                    {% csrf_token %}
                    {% if follower in followings %}
                      <button>íŒ”ë¡œìš° ì·¨ì†Œ</button>
                    {% else %}
                      <button>íŒ”ë¡œìš°</button>
                    {% endif %}
                  </form>
                </div>
                {% if not forloop.last %}
                  <br>
                {% endif %}
                {% endfor %}
              {% else %}
                <div>íŒ”ë¡œì›Œê°€ ì—†ìŠµë‹ˆë‹¤. ì¹œêµ¬ ì°¾ê¸° ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ë³´ì„¸ìš”!</div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      <div class="account-update-buttons">
        <a href="{% url "accounts:update" %}"><button>íšŒì›ì •ë³´ ìˆ˜ì •</button></a>
        <a href="{% url "accounts:password_change" %}"><button>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button></a>
      </div>
    </div>

    <div class="mypage-box">
      <div class="mypage-box-header">
        <button type="button"><div class="mypage-box-buttons" id="sharedPostButton">ê³µìœ  ì¼ê¸°</div></button>
        <button><div class="mypage-box-buttons" id="commentButton">ëŒ“ê¸€</div></button>
        <button><div class="mypage-box-buttons" id="findFriendButton">ì¹œêµ¬ ì°¾ê¸°</div></button>
      </div>

      <div class="mypage-box-body">
        <div class="content-1">
          <div class="box-1">
            <h3>ë‚˜ì—ê²Œ ê³µìœ ëœ ì¼ê¸°</h3>
            <div class="shared-posts-box">
              {% if shared_posts_to_me %}
                {% for post in shared_posts_to_me %}
                  <a href="{% url "posts:detail" post.user.pk post.date %}">
                    <div class="card">
                      {% if post.post_img %}
                        <img src="{{ post.post_img.url }}" class="card-img-top" alt="ì¼ê¸° ì´ë¯¸ì§€">
                      {% else %}
                        <img src="{% static "img/cloud.png" %}" class="card-img-top" alt="ì¼ê¸° ì´ë¯¸ì§€">
                      {% endif %}
                      <div class="card-body">
                        <h5 class="card-title text-truncate">{{ post.title }}</h5>
                        <p class="card-text text-truncate">{{ post.content }}</p>
                      </div>
                    </div>
                  </a>
                {% endfor %}
              {% else %}
                <p>ë‚˜ì—ê²Œ ê³µìœ ëœ ì¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
              {% endif %}
            </div>
          </div>
          <div>
            <h3>ë‚´ê°€ ê³µìœ í•œ ì¼ê¸°</h3>
            <div class="shared-posts-box">
              {% if shared_posts_by_me %}
                {% for post in shared_posts_by_me %}
                  <a href="{% url "posts:detail" post.user.pk post.date %}">
                    <div class="card">
                      {% if post.post_img %}
                        <img src="{{ post.post_img.url }}" class="card-img-top" alt="ì¼ê¸° ì´ë¯¸ì§€">
                      {% else %}
                        <img src="{% static "img/cloud.png" %}" class="card-img-top" alt="ì¼ê¸° ì´ë¯¸ì§€">
                      {% endif %}
                      <div class="card-body">
                        <h5 class="card-title text-truncate">{{ post.title }}</h5>
                        <p class="card-text text-truncate">{{ post.content }}</p>
                      </div>
                    </div>
                  </a>
                {% endfor %}
              {% else %}
                <p>ë‚´ê°€ ê³µìœ í•œ ì¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
              {% endif %}
            </div>
          </div>
        </div>

        <div class="content-2">
          <div class="box-1">
            <h3>ëŒ“ê¸€ì´ ë‹¬ë¦° ë‚´ ì¼ê¸°</h3>
            <div class="shared-posts-box">
              {% if posts_with_comments_by_others %}
                {% for post in posts_with_comments_by_others %}
                  <a href="{% url "posts:detail" post.user.pk post.date %}">
                    <div class="card">
                      {% if post.post_img %}
                        <img src="{{ post.post_img.url }}" class="card-img-top" alt="ì¼ê¸° ì´ë¯¸ì§€">
                      {% else %}
                        <img src="{% static "img/cloud.png" %}" class="card-img-top" alt="ì¼ê¸° ì´ë¯¸ì§€">
                      {% endif %}
                      <div class="card-body">
                        <h5 class="card-title text-truncate">{{ post.title }}</h5>
                        <p class="card-text text-truncate">{{ post.content }}</p>
                      </div>
                    </div>
                  </a>
                {% endfor %}
              {% else %}
                <p>ëŒ“ê¸€ì´ ë‹¬ë¦° ì¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
              {% endif %}
            </div>
          </div>
          <div>
            <h3>ë‚´ê°€ ëŒ“ê¸€ì„ ë‹¨ ì¼ê¸°</h3>
            <div class="shared-posts-box">
              {% if posts_with_my_comments %}
                {% for post in posts_with_my_comments %}
                  <a href="{% url "posts:detail" post.user.pk post.date %}">
                    <div class="card">
                      {% if post.post_img %}
                        <img src="{{ post.post_img.url }}" class="card-img-top" alt="ì¼ê¸° ì´ë¯¸ì§€">
                      {% else %}
                        <img src="{% static "img/cloud.png" %}" class="card-img-top" alt="ì¼ê¸° ì´ë¯¸ì§€">
                      {% endif %}
                      <div class="card-body">
                        <h5 class="card-title text-truncate">{{ post.title }}</h5>
                        <p class="card-text text-truncate">{{ post.content }}</p>
                      </div>
                    </div>
                  </a>
                {% endfor %}
              {% else %}
                <p>ë‚´ê°€ ëŒ“ê¸€ì„ ë‹¨ ì¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
              {% endif %}
            </div>
          </div>
        </div>

        <div class="content-3">
          <h3>ì¹œêµ¬ ì°¾ê¸°</h3>
          <div class="friend-search">
            <input type="text" id="friendSearchInput" class="form-control" placeholder="ğŸ” ì¹œêµ¬ì˜ ì•„ì´ë”” ë˜ëŠ” ë‹‰ë„¤ì„ì„ ê²€ìƒ‰í•´ë³´ì„¸ìš”!">
            <button onclick="searchFriends()">ê²€ìƒ‰</button>
          </div>
          <div id="friendSearchResults" class="friend-search-results"></div>
      </div>      

    </div>
  </div>
{% endblock content %}

{% block js %}
<script src="{% static "js/mypage.js" %}"></script>
{% endblock js %}
