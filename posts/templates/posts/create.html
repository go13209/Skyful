{% extends "base.html" %}
{% load static %}

{% block style %}
  <link rel="stylesheet" href="{% static "css/create.css" %}">
{% endblock style %}

{% block content %}
  <div class="MainBox">
    <h2>일기 작성</h2>
    <div class="CreateForm">
      <form action="{% url 'posts:create' date %}" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}
    
        <!-- 이미지 폼셋 시작 -->
        <label>사진 추가</label>
        {{ formset.management_form }}
        <div class="formset" data-formset-prefix="{{ formset.prefix }}">
          {% for form in formset %}
          <div class="image-container">
            <label for="id_{{ formset.prefix }}-{{ forloop.counter0 }}-image">
              <img class="postImage" src="{% static "img/add-image.png" %}" alt="이미지 추가 버튼">
            </label>
            {{ form }}
          </div>
          {% endfor %}
        </div>

        <div class="form-check form-switch PublicCheck">
          <label class="form-check-label" for="public">공유(서로 친구일 때만 가능)</label>
          <input class="form-check-input" type="checkbox" role="switch" id="public" name="public">
        </div>

        <div class="friendCheck">
          {% for friend in friends %}
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="shared_with" value="{{ friend.id }}" id="friend{{ friend.id }}">
              <label class="form-check-label" for="friend{{ friend.id }}">
                {% if friend.profile_img %}
                  <img src="{{ friend.profile_img.url }}" alt="프로필 이미지">
                {% else %}
                  <img src="{% static "img/user.png" %}" alt="기본 프로필 이미지">
                {% endif %}
                <div>
                  {{ friend.nickname }} ({{ friend.username }})
                </div>
              </label>
            </div>
          {% endfor %}
        </div>

        <button type="submit">작성하기</button>
      </form>
    </div>
    <a href="{% url 'posts:main' %}">⬅️ 돌아가기</a>
  </div>
{% endblock content %}

{% block js %}
  <script src="{% static "js/create.js" %}"></script>
{% endblock js %}